---

title: Prediction of Segmentation Regression - In Bulk (new Images)


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/pred_segreg_bulk.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/pred_segreg_bulk.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Acknowledgement: I took <a href="https://walkwithfastai.com/Segmentation">Zach Mueller's Image Segmentation tutoral notebook</a> (based on the main FastAI lesson notebook) and modified it to do regression (as per Zach's suggestions) and to work with my own data.</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install -Uqq espiownage
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Libraries">Libraries<a class="anchor-link" href="#Libraries"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">espiownage.core</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let's just get clear from the start which model we want:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_to_load</span> <span class="o">=</span> <span class="s1">&#39;seg_reg_full_real_2&#39;</span> <span class="c1"># .pth&#39;</span>

<span class="n">imgdir</span> <span class="o">=</span> <span class="s1">&#39;/home/shawley/datasets/zooniverse_steelpan/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Below you will find the exact imports for everything we use today</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastcore.xtras</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">fastai.callback.hook</span> <span class="kn">import</span> <span class="n">summary</span>
<span class="kn">from</span> <span class="nn">fastai.callback.progress</span> <span class="kn">import</span> <span class="n">ProgressCallback</span>
<span class="kn">from</span> <span class="nn">fastai.callback.schedule</span> <span class="kn">import</span> <span class="n">lr_find</span><span class="p">,</span> <span class="n">fit_flat_cos</span>

<span class="kn">from</span> <span class="nn">fastai.data.block</span> <span class="kn">import</span> <span class="n">DataBlock</span>
<span class="kn">from</span> <span class="nn">fastai.data.external</span> <span class="kn">import</span> <span class="n">untar_data</span><span class="p">,</span> <span class="n">URLs</span>
<span class="kn">from</span> <span class="nn">fastai.data.transforms</span> <span class="kn">import</span> <span class="n">get_image_files</span><span class="p">,</span> <span class="n">FuncSplitter</span><span class="p">,</span> <span class="n">Normalize</span>

<span class="kn">from</span> <span class="nn">fastai.layers</span> <span class="kn">import</span> <span class="n">Mish</span>   <span class="c1"># MishJIT gives me trouble :-( </span>
<span class="kn">from</span> <span class="nn">fastai.losses</span> <span class="kn">import</span> <span class="n">BaseLoss</span><span class="p">,</span> <span class="n">MSELossFlat</span><span class="p">,</span> <span class="n">CrossEntropyLossFlat</span><span class="p">,</span> <span class="n">BCEWithLogitsLossFlat</span>
<span class="kn">from</span> <span class="nn">fastai.optimizer</span> <span class="kn">import</span> <span class="n">ranger</span>

<span class="kn">from</span> <span class="nn">fastai.torch_core</span> <span class="kn">import</span> <span class="n">tensor</span>

<span class="kn">from</span> <span class="nn">fastai.vision.augment</span> <span class="kn">import</span> <span class="n">aug_transforms</span>
<span class="kn">from</span> <span class="nn">fastai.vision.core</span> <span class="kn">import</span> <span class="n">PILImage</span><span class="p">,</span> <span class="n">PILMask</span>
<span class="kn">from</span> <span class="nn">fastai.vision.data</span> <span class="kn">import</span> <span class="n">ImageBlock</span><span class="p">,</span> <span class="n">MaskBlock</span><span class="p">,</span> <span class="n">imagenet_stats</span>
<span class="kn">from</span> <span class="nn">fastai.vision.learner</span> <span class="kn">import</span> <span class="n">unet_learner</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torchvision.models.resnet</span> <span class="kn">import</span> <span class="n">resnet34</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/home/shawley/datasets/espiownage-cleaner/&#39;</span><span class="p">)</span>  <span class="c1"># real data is local and private </span>
<span class="n">bin_size</span> <span class="o">=</span> <span class="mf">0.7</span>  
<span class="n">maskdir</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;masks_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bin_size</span><span class="p">))</span>
<span class="n">path_im</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;images&#39;</span>
<span class="n">path_lbl</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">maskdir</span>
<span class="n">meta_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;annotations&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/*.csv&#39;</span><span class="p">))</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta_to_img_path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">img_bank</span><span class="o">=</span><span class="n">path_im</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">meta_names</span><span class="p">]</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">fnames</span><span class="p">)</span>
<span class="n">lbl_names</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path_lbl</span><span class="p">)</span>
<span class="n">get_msk</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">path</span><span class="o">/</span><span class="n">maskdir</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s1">_P</span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="o">/</span><span class="n">bin_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))];</span> <span class="n">codes</span>
<span class="n">sz</span> <span class="o">=</span> <span class="p">(</span><span class="mi">384</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">ImageBlock</span><span class="p">,</span> <span class="n">MaskBlock</span><span class="p">(</span><span class="n">codes</span><span class="p">)),</span>
    <span class="n">get_items</span><span class="o">=</span><span class="n">get_image_files</span><span class="p">,</span>
    <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(),</span>
    <span class="n">get_y</span><span class="o">=</span><span class="n">get_msk</span><span class="p">,</span>
    <span class="n">batch_tfms</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">aug_transforms</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">sz</span><span class="p">,</span> <span class="n">flip_vert</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">from_stats</span><span class="p">(</span><span class="o">*</span><span class="n">imagenet_stats</span><span class="p">)])</span>
    
<span class="n">dls</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="n">fnames</span><span class="o">=</span><span class="n">fnames</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># smaller batch size because we&#39;re now full size</span>
<span class="n">dls</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">codes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/shawley/envs/espi/lib/python3.8/site-packages/torch/_tensor.py:575: UserWarning: floor_divide is deprecated, and will be removed in a future version of pytorch. It currently rounds toward 0 (like the &#39;trunc&#39; function NOT &#39;floor&#39;). This results in incorrect rounding for negative values.
To keep the current behavior, use torch.div(a, b, rounding_mode=&#39;trunc&#39;), or for actual floor division, use torch.div(a, b, rounding_mode=&#39;floor&#39;). (Triggered internally at  /pytorch/aten/src/ATen/native/BinaryOps.cpp:467.)
  return torch.floor_divide(self, other)
/home/shawley/envs/espi/lib/python3.8/site-packages/torch/_tensor.py:1023: UserWarning: torch.solve is deprecated in favor of torch.linalg.solveand will be removed in a future PyTorch release.
torch.linalg.solve has its arguments reversed and does not return the LU factorization.
To get the LU factorization see torch.lu, which can be used with torch.lu_solve or torch.lu_unpack.
X = torch.solve(B, A).solution
should be replaced with
X = torch.linalg.solve(A, B) (Triggered internally at  /pytorch/aten/src/ATen/native/BatchLinearAlgebra.cpp:760.)
  ret = func(*args, **kwargs)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">opt</span> <span class="o">=</span> <span class="n">ranger</span> 
<span class="n">hrfac</span> <span class="o">=</span> <span class="mf">1.2</span>  <span class="c1"># &#39;headroom factor&#39;</span>
<span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)];</span> <span class="n">codes</span>
<span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span><span class="o">*</span><span class="n">hrfac</span><span class="p">))</span>  <span class="c1"># balance between &quot;clamping&quot; to range of real data vs too much &quot;compression&quot; from sigmoid nonlineari</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">unet_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet34</span><span class="p">,</span> <span class="n">n_out</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">MSELossFlat</span><span class="p">(),</span> <span class="n">self_attention</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">act_cls</span><span class="o">=</span><span class="n">Mish</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">opt</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;seg_reg_full_real_2&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/shawley/envs/espi/lib/python3.8/site-packages/torch/nn/functional.py:718: UserWarning: Named tensors and all their associated APIs are an experimental feature and subject to change. Please do not use them for anything important until they are released as stable. (Triggered internally at  /pytorch/c10/core/TensorImpl.h:1156.)
  return torch.max_pool2d(input, kernel_size, stride, padding, dilation, ceil_mode)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;fastai.learner.Learner at 0x7f6da18775b0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_tmask</span><span class="p">(</span><span class="n">tmask</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> <span class="c1"># save tensor mask</span>
    <span class="n">tmask_new</span> <span class="o">=</span> <span class="n">tmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> 
    <span class="n">use_min</span><span class="p">,</span> <span class="n">use_max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>    <span class="c1"># use scale of max ring count</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span> <span class="n">use_min</span><span class="p">,</span> <span class="n">use_max</span> <span class="o">=</span> <span class="n">tmask_new</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">tmask_new</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>   <span class="c1"># auto scale for just this image</span>
    <span class="n">rescaled</span> <span class="o">=</span> <span class="p">(</span><span class="mf">255.0</span> <span class="o">/</span> <span class="n">use_max</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmask_new</span> <span class="o">-</span> <span class="n">use_min</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rescaled</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pfnames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">imgdir</span><span class="o">+</span><span class="s1">&#39;/*.png&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pfnames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pfnames</span><span class="p">[</span><span class="mi">1000</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pfnames</span><span class="p">))</span>

<span class="n">pf</span> <span class="o">=</span> <span class="n">pfnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">img</span> <span class="o">=</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span>

<span class="c1">#dlpred = dls.test_dl([pfile])</span>
<span class="c1">#preds, _ = learn.get_preds(dl=dlpred)</span>
<span class="c1">#preds = preds.squeeze(1)</span>
<span class="c1">#print(preds.shape)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/shawley/datasets/zooniverse_steelpan/06240907_proc_00000.png /home/shawley/datasets/zooniverse_steelpan/06240907_proc_01000.png
14000
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dlpred</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">test_dl</span><span class="p">(</span><span class="n">pfnames</span><span class="p">)</span>
<span class="n">preds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="n">dlpred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;bulk_segreg&#39;</span>
<span class="o">!</span>mkdir <span class="o">{</span>outdir<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>mkdir: cannot create directory ‘bulk_segreg’: File exists
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pfile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pfnames</span><span class="p">):</span>
    <span class="n">mfile</span> <span class="o">=</span> <span class="n">outdir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">pfile</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_RM.png&#39;</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span> <span class="mi">250</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: saving </span><span class="si">{</span><span class="n">mfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
    <span class="n">im</span> <span class="o">=</span> <span class="n">save_tmask</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mfile</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0: saving bulk_segreg/06240907_proc_00000_RM.png
250: saving bulk_segreg/06240907_proc_00250_RM.png
500: saving bulk_segreg/06240907_proc_00500_RM.png
750: saving bulk_segreg/06240907_proc_00750_RM.png
1000: saving bulk_segreg/06240907_proc_01000_RM.png
1250: saving bulk_segreg/06240907_proc_01250_RM.png
1500: saving bulk_segreg/06240907_proc_01500_RM.png
1750: saving bulk_segreg/06240907_proc_01750_RM.png
2000: saving bulk_segreg/06240909_proc_00000_RM.png
2250: saving bulk_segreg/06240909_proc_00250_RM.png
2500: saving bulk_segreg/06240909_proc_00500_RM.png
2750: saving bulk_segreg/06240909_proc_00750_RM.png
3000: saving bulk_segreg/06240909_proc_01000_RM.png
3250: saving bulk_segreg/06240909_proc_01250_RM.png
3500: saving bulk_segreg/06240909_proc_01500_RM.png
3750: saving bulk_segreg/06240909_proc_01750_RM.png
4000: saving bulk_segreg/06240910_proc_00000_RM.png
4250: saving bulk_segreg/06240910_proc_00250_RM.png
4500: saving bulk_segreg/06240910_proc_00500_RM.png
4750: saving bulk_segreg/06240910_proc_00750_RM.png
5000: saving bulk_segreg/06240910_proc_01000_RM.png
5250: saving bulk_segreg/06240910_proc_01250_RM.png
5500: saving bulk_segreg/06240910_proc_01500_RM.png
5750: saving bulk_segreg/06240910_proc_01750_RM.png
6000: saving bulk_segreg/06240912_proc_00000_RM.png
6250: saving bulk_segreg/06240912_proc_00250_RM.png
6500: saving bulk_segreg/06240912_proc_00500_RM.png
6750: saving bulk_segreg/06240912_proc_00750_RM.png
7000: saving bulk_segreg/06240912_proc_01000_RM.png
7250: saving bulk_segreg/06240912_proc_01250_RM.png
7500: saving bulk_segreg/06240912_proc_01500_RM.png
7750: saving bulk_segreg/06240912_proc_01750_RM.png
8000: saving bulk_segreg/06240913_proc_00000_RM.png
8250: saving bulk_segreg/06240913_proc_00250_RM.png
8500: saving bulk_segreg/06240913_proc_00500_RM.png
8750: saving bulk_segreg/06240913_proc_00750_RM.png
9000: saving bulk_segreg/06240913_proc_01000_RM.png
9250: saving bulk_segreg/06240913_proc_01250_RM.png
9500: saving bulk_segreg/06240913_proc_01500_RM.png
9750: saving bulk_segreg/06240913_proc_01750_RM.png
10000: saving bulk_segreg/06240914_proc_00000_RM.png
10250: saving bulk_segreg/06240914_proc_00250_RM.png
10500: saving bulk_segreg/06240914_proc_00500_RM.png
10750: saving bulk_segreg/06240914_proc_00750_RM.png
11000: saving bulk_segreg/06240914_proc_01000_RM.png
11250: saving bulk_segreg/06240914_proc_01250_RM.png
11500: saving bulk_segreg/06240914_proc_01500_RM.png
11750: saving bulk_segreg/06240914_proc_01750_RM.png
12000: saving bulk_segreg/06241902_proc_00000_RM.png
12250: saving bulk_segreg/06241902_proc_00250_RM.png
12500: saving bulk_segreg/06241902_proc_00500_RM.png
12750: saving bulk_segreg/06241902_proc_00750_RM.png
13000: saving bulk_segreg/06241902_proc_01000_RM.png
13250: saving bulk_segreg/06241902_proc_01250_RM.png
13500: saving bulk_segreg/06241902_proc_01500_RM.png
13750: saving bulk_segreg/06241902_proc_01750_RM.png
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

